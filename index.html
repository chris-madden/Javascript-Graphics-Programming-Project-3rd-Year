<!DOCTYPE html>

<html>

<head>
    <meta charset="UTF-8">
    <title>Canvas</title>

    <style type="text/css">
        body {
            background-color: white;
        }
        
        canvas {
            border: 2px solid black;
        }
    </style>

</head>

<body>

    <canvas id="canvasOne"></canvas>

    <script type="text/javascript">
        // Gets a handle to the element with id canvasOne.
        var canvas = document.getElementById("canvasOne");

        // Set the canvas up for drawing in 2D.
        var ctx = canvas.getContext("2d");

        // Global variables
        var bulletOnScreen = false; // Variable tracking if bullet is on screen or not
        var positionFlag = 0; // Used as an access variable to update the bullets postion with the new ship position
        var hitShip = false;
    
        //Resizes canvas when file opened
        function onLoad() {
            canvas.width = 600;
            canvas.height = 800;
            drawUserShip();
        }

        //Draws the users ship to the canvas
        function drawUserShip() {
            /*//Clear the canvas each time method is called
            ctx.clearRect(0, 0, canvas.width, canvas.height);*/
            
            ctx.fillStyle = "rgb(0, 255, 0)";

            //Start path for drawing ship
            ctx.beginPath();

            //Position the top of ship will be at
            ctx.moveTo(userShipObject.shipTopPosition.x, userShipObject.shipTopPosition.y);

            //Draw line to left corner of ship
            ctx.lineTo(userShipObject.shipLeftPostiton.x, userShipObject.shipLeftPostiton.y);

            //Draw line to right corner of ship
            ctx.lineTo(userShipObject.shipRightPosition.x, userShipObject.shipRightPosition.y);

            //Colour in the ship
            ctx.fill();

            //Close the path
            ctx.closePath();
        }// End drawUserShip
        
        //Draw an enemy
        function drawEnemy() 
        {
            
            // Enemies are red
            ctx.fillStyle = "rgb(255, 0, 0)";

            //Start path for drawing ship
            ctx.beginPath();

            // Draw the square for the bullet
            ctx.rect(enemy.position.x, enemy.position.y, enemy.size.width, enemy.size.height);

            // Fill the square with a solid colour
            ctx.fill();

            // Close path to finish drawing bullet
            ctx.closePath();

        }
       
        //Enemy object
        var enemy = {
            
             position: {

                    x: 275,
                    y: 300
                   
                },
                size: {

                    width: 50,
                    height: 50

                },
                velocity: {

                    y: 5

                }
            
        }
        
        //Function for moving enemy
        function moveEnemy()
        {
           
           // Enemy falls from top of canvas until it reaches the bottom
           if((enemy.position.y + enemy.size.height) < canvas.height)
           {
               
               enemy.position.y += 1;
               
           }
           
           if(enemy.position.y == 400)
           { 
               
               console.log("I've reached 400!!");
               
           }
            
                // Senses if it hits the top of the ship                                    User ship top is at bottom left of enemy 
           if((enemy.position.y + enemy.size.height) ==  userShipObject.shipTopPosition.y && userShipObject.shipTopPosition.x >= enemy.position.x && userShipObject.shipTopPosition.x <= (enemy.position.x + enemy.size.width))
           {
               
               console.log("I've hit the ship!!!!");
                
               // Clear user ship from screen when hit by enemy
               ctx.clearRect(userShipObject.shipLeftPostiton.x, userShipObject.shipTopPosition.y, userShipObject.shipRightPosition.x, userShipObject.shipRightPosition.y);
               
               hitShip = true;
               
           }
            
            console.log("Top of ship X,Y = " + userShipObject.shipTopPosition.x + "," + userShipObject.shipTopPosition.y);
            
        }
          
        //Function repeats when it's called in animate which makes the bullet travel by itself after being shot
        function fireBullet(updatedX, updatedY, flag) {

            //Only update variable on first frame
            if (flag == 1) {
                //Update the bullet position with the ships location
                bullet.position.x = updatedX;
                bullet.position.y = updatedY;
            }

            // Draw the bullet to the canvas
            drawBullet();
            
            // If position of top of the bullet is greater than the bullet height (4)
            if (bullet.position.y >= 0){
                
                bullet.position.y -= bullet.velocity.y;
                //console.log("\n**bullet Positon " + bullet.position.y + "***");
            }                                                                       
          
            else 
            {
                //changes to false when there's a collsion with the top of the canvas
                bulletOnScreen= false;

                //Clear the bullet from the canvas when it collides with top of canvas
                ctx.clearRect(bullet.position.x, bullet.position.y, bullet.size.width, bullet.size.height);

            }
          
            // Reset flag
            flag == 0;

        }
        
        // Create object for user ship
        // ===========================

        //Object for the user Ship
        var userShipObject = {

                shipTopPosition: {

                    x: 300,
                    y: 700

                },
                shipLeftPostiton: {

                    x: 275,
                    y: 725

                },
                shipRightPosition: {

                    x: 325,
                    y: 725

                },
                acceleration: {

                    x: 7,
                    y: 0

                },
                moveRight: function () {

                    //If ships right corner isn't touching the edge of the canvas and is less than or equal to the canvas width - the acceleration value
                    if (userShipObject.shipRightPosition.x < canvas.width && userShipObject.shipRightPosition.x <= (canvas.width - userShipObject.acceleration.x)) {
                        //Move the ship to the right along the x axis to the speed set in the acceleration object
                        userShipObject.shipTopPosition.x += userShipObject.acceleration.x;
                        userShipObject.shipLeftPostiton.x += userShipObject.acceleration.x;
                        userShipObject.shipRightPosition.x += userShipObject.acceleration.x;
                    }
                    //If ships postion is greater than the (canvas width - acceleration distance) E.G 595 > 590. Only move the number of pixels required to reach 600 (canvas.width)
                    else if (userShipObject.shipRightPosition.x > (canvas.width - userShipObject.acceleration.x)) {
                        //Move ship the pixels required to reach edge of canvas
                        userShipObject.shipTopPosition.x += (canvas.width - userShipObject.shipRightPosition.x);
                        userShipObject.shipLeftPostiton.x += (canvas.width - userShipObject.shipRightPosition.x);
                        userShipObject.shipRightPosition.x += (canvas.width - userShipObject.shipRightPosition.x);
                    }

                },
                moveLeft: function () {

                    //If shipLeftPostiton.x is greater than 0 and greater than or equal to acceleration.x
                    if (userShipObject.shipLeftPostiton.x > 0 && userShipObject.shipLeftPostiton.x >= userShipObject.acceleration.x) {
                        //Move the ship to the left along the x axis to the speed set in the acceleration object
                        userShipObject.shipTopPosition.x -= userShipObject.acceleration.x;
                        userShipObject.shipLeftPostiton.x -= userShipObject.acceleration.x;
                        userShipObject.shipRightPosition.x -= userShipObject.acceleration.x;
                    } else if (userShipObject.shipLeftPostiton.x < userShipObject.acceleration.x) //shipLeftPostiton.x less than acceleration.x
                    {
                        //Move the ship to the left along the x axis to the amount of remaining pixels
                        userShipObject.shipRightPosition.x -= userShipObject.shipLeftPostiton.x;
                        userShipObject.shipTopPosition.x -= userShipObject.shipLeftPostiton.x;
                        userShipObject.shipLeftPostiton.x -= userShipObject.shipLeftPostiton.x;
                    }

                }

            } //End of userShipObject

        // Draw bullet and create bullet object
        // ====================================
        
        //Draws the bullet
        function drawBullet() {

            ctx.fillStyle = "rgb(0, 100, 0)";
            
            //Start path for drawing ship
            ctx.beginPath();

            // Draw the square for the bullet
            ctx.rect(bullet.position.x, bullet.position.y, bullet.size.width, bullet.size.height);

            // Fill the square with a solid colour
            ctx.fill();

            // Close path to finish drawing bullet
            ctx.closePath();
            
        }

        // Bullet Object
        var bullet = {
                
                // Bullet shoots from top of ship
                position: {

                    x: (userShipObject.shipTopPosition.x - 2),
                    y: (userShipObject.shipTopPosition.y - 2)

                },
                size: {

                    width: 4,
                    height: 4

                },
                velocity: {

                    y: 10

                }

            } //End bullet object
        
        // Start running game from here
        // =============================
        
        //Initialise size of canvas
        onLoad();
        
        //Repeated function which takes care of the animation frames
        function animate() 
        {
            //Clear the canvas each time method is called
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            // Draw user ship if it hasn't been hit
            if(hitShip == false)
            {
                drawUserShip();
            }
            
            drawEnemy();
            moveEnemy(); 
           
            // If bullet has been fired and is onscreen
            if (bulletOnScreen == true) {

                //Run the fire method
                fireBullet();
                
                // Prepares flag for updating ships position for when next bullet is fired
                positionFlag = 1;
            }
            
            requestAnimationFrame(animate);
        }

        //Adding an event listener so user can use keys to move ship
        window.addEventListener("keydown", function (event) {
            
            if (event.keyCode == 39) //If right arrow key is pressed
            {   
                userShipObject.moveRight();

            } else if (event.keyCode == 37) //If left arrow key is pressed
            {
                userShipObject.moveLeft();
                
            } else if (event.keyCode == 32 && bulletOnScreen == false) //If the spacebar is pressed and there is no bullet on the screen
            {
                
                // When bullet fires change variable to true
                bulletOnScreen = true;
                
                // Set to 1 so bullet position can be updated with the ships new position
                positionFlag = 1;
                fireBullet((userShipObject.shipTopPosition.x - 2), (userShipObject.shipTopPosition.y - 2), positionFlag);
                       
            }

        }); //End event listener

        //Call the animate method 
        animate();
    </script>

</body>

</html>